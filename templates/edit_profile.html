{% extends "base.html" %}
{% block content %}
<div class="container content-card">
  <h2>Edit Profile</h2>
  {% if error %}
  <div class="alert alert-error">{{ error }}</div>
  {% endif %}
  <form method="post" enctype="multipart/form-data" class="auth-form">
    <label class="field">Username
      <input name="username" value="{{ user_obj.username or '' }}" required />
    </label>
    <label class="field">Full name
      <input name="full_name" value="{{ user_obj.full_name or '' }}" />
    </label>
    <label class="field">Date of birth
      <input name="date_of_birth" type="date" value="{{ user_obj.date_of_birth or '' }}" />
    </label>
    <label class="field">Bio
      <textarea name="bio">{{ user_obj.bio or '' }}</textarea>
    </label>
    <label class="field">Avatar
      <div style="display:flex;gap:12px;align-items:center">
        <div style="width:96px;height:96px;overflow:hidden;border-radius:12px;border:1px solid #eee">
          {% if user_obj.avatar %}
          <img id="avatarPreview" src="/download/{{ user_obj.avatar }}?inline=1" alt="avatar" style="width:100%;height:100%;object-fit:cover" />
          {% else %}
          <img id="avatarPreview" src="/static/icons/avatar-placeholder.png" alt="avatar" style="width:100%;height:100%;object-fit:cover" />
          {% endif %}
        </div>
        <div style="flex:1">
          <input id="avatarInput" name="avatar" type="file" accept="image/*" />
          <div class="muted" style="font-size:12px;margin-top:6px">Choose a square image (PNG/JPG). Preview updates immediately.</div>
        </div>
      </div>
    </label>
    <div class="auth-actions"><button class="btn">Save</button><a class="btn btn--ghost" href="/me">Cancel</a></div>
  </form>
</div>
<script>
  (function(){
    const input = document.getElementById('avatarInput');
    const preview = document.getElementById('avatarPreview');
    if (!input || !preview) return;
    input.addEventListener('change', (ev)=>{
      const f = ev.target.files && ev.target.files[0];
      if (!f) return;
      if (!f.type.startsWith('image/')) return;
      const reader = new FileReader();
      reader.onload = function(e){ preview.src = e.target.result; };
      reader.readAsDataURL(f);
    });
  })();
</script>
{% endblock %}
