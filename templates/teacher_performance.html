{% extends "base.html" %}

{% block title %}Teacher Performance — {{ classroom.name }}{% endblock %}

{% block content %}
  <div class="content-card">
    <h1 style="margin-bottom:8px;">Teacher performance — {{ classroom.name }}</h1>
    <p class="muted" style="margin-bottom:12px;">Overview of activity across teachers and students in this classroom.</p>
    <p style="margin-bottom:12px;">
      <a class="btn btn--ghost" href="/classrooms/{{ classroom.id }}/library">Back to classroom</a>
      <a class="btn btn--ghost" href="/classrooms/{{ classroom.id }}/performance.csv" style="margin-left:8px;">Download CSV</a>
      <a class="btn btn--ghost" href="/classrooms/{{ classroom.id }}/performance/students" style="margin-left:8px;">Student metrics (JSON)</a>
    </p>

    {% if teachers %}
<<<<<<< HEAD
      <table>
        <thead><tr><th>Teacher</th><th>Assignments Created</th><th>Materials Uploaded</th><th>Submissions Received</th></tr></thead>
        <tbody>
          {% for t in teachers %}
          <tr>
            <td>
              {{ t.username or t.user_id }}
              {% if t.site_role == 'teacher' %}
                <span title="Teacher" style="color:#2563eb;">★</span>
              {% elif t.site_role == 'student' %}
                <span title="Student" style="color:#f59e0b;">★</span>
              {% elif t.site_role == 'individual' %}
                <span title="Individual" style="color:#dc2626;">★</span>
              {% elif t.site_role == 'passerby' %}
                <span title="Passerby" style="color:#111827;">★</span>
              {% endif %}
            </td>
            <td>{{ t.assignments_count }}</td>
            <td>{{ t.uploads_count }}</td>
            <td>{{ t.submissions_count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
=======
      <div style="overflow-x:auto;">
        <table class="data-table" style="width:100%;border-collapse:collapse;font-size:14px;">
          <thead>
            <tr>
              <th style="text-align:left;padding:8px;border-bottom:1px solid var(--border);">Teacher</th>
              <th style="text-align:right;padding:8px;border-bottom:1px solid var(--border);">Assignments created</th>
              <th style="text-align:right;padding:8px;border-bottom:1px solid var(--border);">Materials uploaded</th>
              <th style="text-align:right;padding:8px;border-bottom:1px solid var(--border);">Submissions received</th>
            </tr>
          </thead>
          <tbody>
            {% for t in teachers %}
            <tr>
              <td style="padding:8px;border-bottom:1px solid var(--border);">{{ t.username or t.user_id }}</td>
              <td style="padding:8px;border-bottom:1px solid var(--border);text-align:right;">{{ t.assignments_count }}</td>
              <td style="padding:8px;border-bottom:1px solid var(--border);text-align:right;">{{ t.uploads_count }}</td>
              <td style="padding:8px;border-bottom:1px solid var(--border);text-align:right;">{{ t.submissions_count }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
>>>>>>> 0b92d6c (Commit local UI and model changes)
    {% else %}
      <p class="muted">No teachers found for this classroom.</p>
    {% endif %}

    <h2 style="margin-top:18px;">Per-student engagement</h2>
    <div id="student-chart" style="margin-top:8px;"></div>
  </div>

  <script>
    async function renderStudents(){
      try{
        const res = await fetch('/api/classrooms/{{ classroom.id }}/performance/students');
        const j = await res.json();
        const el = document.getElementById('student-chart');
        if(!j.students || j.students.length===0){ el.innerText='No student metrics'; return }
        let html = '<div style="overflow-x:auto;"><table class="data-table" style="width:100%;border-collapse:collapse;font-size:14px;"><thead><tr>' +
          '<th style="text-align:left;padding:8px;border-bottom:1px solid var(--border);">Student</th>' +
          '<th style="text-align:right;padding:8px;border-bottom:1px solid var(--border);">Submissions</th>' +
          '<th style="text-align:right;padding:8px;border-bottom:1px solid var(--border);">Attendance</th>' +
          '<th style="text-align:right;padding:8px;border-bottom:1px solid var(--border);">Events</th>' +
          '</tr></thead><tbody>';
        for(const s of j.students){
          html += `<tr>`+
            `<td style="padding:8px;border-bottom:1px solid var(--border);">${s.username||s.user_id}</td>`+
            `<td style="padding:8px;border-bottom:1px solid var(--border);text-align:right;">${s.submissions_count}</td>`+
            `<td style="padding:8px;border-bottom:1px solid var(--border);text-align:right;">${s.attendance_count}</td>`+
            `<td style="padding:8px;border-bottom:1px solid var(--border);text-align:right;">${s.events_count}</td>`+
            `</tr>`;
        }
        html += '</tbody></table></div>';
        el.innerHTML = html;
      }catch(e){ console.error(e); }
    }
    renderStudents();
  </script>
{% endblock %}
