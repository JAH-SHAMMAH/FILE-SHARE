{% extends "base.html" %}

{% block content %}
<div class="container content-card">
  <h2>Search results</h2>
  <form method="get" class="hero-search" style="margin-bottom:12px">
    <input name="q" value="{{ q }}" placeholder="Search presentations, authors, tags..." />
    <button class="btn" type="submit">Search</button>
  </form>

  {% if results %}
  <div class="grid grid--cards">
    {% for r in results %}
    <article class="card" data-pid="{{ r.id }}">
      {% set is_pdf = r.filename and r.filename.lower().endswith('.pdf') %}
      {% set slide_thumb = '/presentations/' ~ r.id ~ '/slide/0' %}
      {% set thumb_pdf = '/download/' ~ r.filename ~ '?inline=1#page=1&view=FitH&toolbar=0&navpanes=0' if is_pdf else None %}
      {% set cover_or_pdf = r.cover_url or thumb_pdf or request.url_for('static', path='cover-placeholder.svg') %}

      <a class="card__link" href="{{ url_for('view_presentation', presentation_id=r.id) }}">
        <div class="card__thumb" style="position:relative;">
          {% if is_pdf %}
          <iframe class="thumb-frame" src="{{ cover_or_pdf }}" loading="lazy"></iframe>
          {% else %}
          <img src="{{ slide_thumb }}" alt="{{ r.title }}" loading="lazy" data-placeholder="{{ request.url_for('static', path='slide-placeholder.svg') }}" onerror="this.onerror=null;this.src=this.dataset.placeholder" />
          {% endif %}
        </div>
        <div class="card__body">
          <h4>{{ r.title }}</h4>
          <p class="muted">by&nbsp;{% if r.owner_username %}<a href="/users/{{ r.owner_username }}">{{ r.owner_username }}</a> <span class="role-badge role-badge--passerby">★</span>{% else %}Unknown{% endif %}</p>
          <p class="muted" style="margin-top:6px;">
            {% if r.owner_presentation_count is defined %}<strong>{{ r.owner_presentation_count }}</strong> presentations{% endif %}
            {% if r.views is defined %} · <strong>{{ r.views }}</strong> views{% endif %}
            {% if r.likes_count is defined %} · <strong>{{ r.likes_count }}</strong> likes{% endif %}
            <span class="card__saved" title="Saved count" data-id="{{ r.id }}">⭐ {{ r.bookmarks_count or 0 }}</span>
          </p>
        </div>
      </a>
      <button class="card__bookmark" type="button" data-id="{{ r.id }}" aria-label="Save presentation" title="Save for later">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 3a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18l-7-4-7 4V3z"/></svg>
      </button>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty">No results found for "{{ q }}".</div>
  {% endif %}
</div>
{% endblock %}
