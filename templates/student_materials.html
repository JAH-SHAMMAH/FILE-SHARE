{% extends "base.html" %}

{% block title %}Materials from your teachers{% endblock %}

{% block content %}
<div class="container content-card">
  <h2>Materials from your teachers</h2>
  <p class="muted" style="margin-bottom:12px;font-size:13px;">Presentations uploaded by teachers from the classrooms you are in.</p>

  {% if results %}
  <div class="grid grid--cards">
    {% for r in results %}
    <article class="card" data-pid="{{ r.id }}">
      {% set is_pdf = r.filename and r.filename.lower().endswith('.pdf') %}
      {% set slide_thumb = '/presentations/' ~ r.id ~ '/slide/0' %}
      {% set thumb_pdf = '/download/' ~ r.filename ~ '?inline=1#page=1&view=FitH&toolbar=0&navpanes=0' if is_pdf else None %}
      {% set cover_or_pdf = r.cover_url or thumb_pdf or request.url_for('static', path='cover-placeholder.svg') %}

      <a class="card__link" href="{{ url_for('view_presentation', presentation_id=r.id) }}">
        <div class="card__thumb" style="position:relative;">
          {% if is_pdf %}
          <iframe class="thumb-frame" src="{{ cover_or_pdf }}" loading="lazy"></iframe>
          {% else %}
          <img src="{{ slide_thumb }}" alt="{{ r.title }}" loading="lazy" data-placeholder="{{ request.url_for('static', path='slide-placeholder.svg') }}" onerror="this.onerror=null;this.src=this.dataset.placeholder" />
          {% endif %}
        </div>
        <div class="card__body">
          <h4>{{ r.title }}</h4>
          <p class="muted">by {% if r.owner_username %}<a href="/users/{{ r.owner_username }}">{{ r.owner_username }}</a>{% else %}Unknown{% endif %}</p>
          <p class="muted" style="margin-top:6px;">
            {% if r.owner_presentation_count is defined %}<strong>{{ r.owner_presentation_count }}</strong> presentations{% endif %}
            {% if r.views is defined %} · <strong>{{ r.views }}</strong> views{% endif %}
            {% if r.likes_count is defined %} · <strong>{{ r.likes_count }}</strong> likes{% endif %}
            <span class="card__saved" title="Saved count" data-id="{{ r.id }}">⭐ {{ r.bookmarks_count or 0 }}</span>
          </p>
        </div>
      </a>
    </article>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty">No materials from your teachers yet.</div>
  {% endif %}
</div>
{% endblock %}
