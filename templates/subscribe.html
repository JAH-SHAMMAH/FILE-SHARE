{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width:900px; margin:0 auto;">
  <div class="content-card" style="padding:32px; border-radius:18px; box-shadow:0 14px 40px rgba(15,23,42,0.12);">
    <div style="display:flex; justify-content:space-between; gap:20px; align-items:flex-start; flex-wrap:wrap;">
      <div style="flex:1 1 320px;">
        <div class="pill">Premium</div>
        <h1 style="margin:8px 0 6px 0;">Power up your presentations</h1>
        <p class="muted" style="margin:0 0 16px 0;">Unlimited uploads, faster conversions, and priority support. Subscribe securely with Paystack.</p>
        <ul class="muted" style="line-height:1.6; margin:0 0 18px 18px;">
          <li>Instant access to the premium dashboard</li>
          <li>Faster PDF conversions and downloads</li>
          <li>Priority support and analytics</li>
        </ul>
        {% if error %}
        <div class="alert alert-error" style="margin-top:12px;">{{ error }}</div>
        {% endif %}
      </div>
      <div style="flex:0 0 320px; background:linear-gradient(135deg,#0ea5e9,#6366f1); color:#fff; padding:22px; border-radius:14px; box-shadow:0 10px 28px rgba(99,102,241,0.35);">
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <h3 style="margin:0;">Premium Access</h3>
          <span style="background:rgba(255,255,255,0.16); padding:6px 12px; border-radius:10px; font-size:13px;">{{ currency }}</span>
        </div>
        <div style="margin:14px 0 6px 0; font-size:42px; font-weight:700;">{{ amount | round(2) }}</div>
        <p style="margin:0 0 18px 0; opacity:0.9;">One-time purchase unlocks premium features.</p>
        <button id="paystack-btn" class="btn full-btn" style="width:100%; background:#fff; color:#0b466b;" {% if error %}disabled{% endif %}>Pay with Paystack</button>
        <p class="muted" style="margin:10px 0 0 0; font-size:12px; color:rgba(255,255,255,0.85);">Secured by Paystack. You'll be redirected to complete payment.</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function() {
    const btn = document.getElementById('paystack-btn');
    if (!btn) return;
    btn.addEventListener('click', async () => {
      btn.disabled = true;
      btn.textContent = 'Starting paymentâ€¦';
      try {
        const res = await fetch('/api/paystack/initialize', { method: 'POST' });
        if (!res.ok) throw new Error('Unable to start payment');
        const data = await res.json();
        if (data.authorization_url) {
          window.location.href = data.authorization_url;
        } else {
          throw new Error('Missing authorization URL');
        }
      } catch (err) {
        alert(err.message || 'Payment error');
        btn.disabled = false;
        btn.textContent = 'Pay with Paystack';
      }
    });
  })();
</script>
{% endblock %}
